{% extends "base.html" %}

{% block title %}
<title>{{type|capfirst}}</title>
{% endblock %}

{% block tablesortlib %}{% endblock %}
{% block visjslib %}{% endblock %}
{% block jquery %}
{% if type == "threat-actor" or type == "identity" %}
<script type="text/javascript" src="/static/highcharts/highcharts.js"></script>
<script type="text/javascript" src="/static/highcharts/modules/data.js"></script>
<script type="text/javascript" src="/static/highcharts/modules/drilldown.js"></script>
<script src="/static/js/chart_ati.js"></script>
<script src="/static/js/chart_tgt.js"></script>
{% endif %}
<script>
function getDataTable(type){
	$('#objtype_table').dataTable({
            //"destroy":true,
            "processing":true,
            "serverSide":true,
            //"ajax": "/data/{{type}}",
            "ajax": "/data/"+type,
            "order":[0, 'desc'],
            "lengthMenu": [[ 10, 50, 100, 200 ],[ 10, 50, 100, 200 ],],
            "pageLength": 10,
            "stateSave": true,
        });
};
$(document).ready(
    function(){
        $('a[data-toggle="tab"]').on( 'shown.bs.tab', function (e) {
            $.fn.dataTable.tables( {visible: true, api: true} ).columns.adjust();
        } );
        getDataTable("{{type}}");
        $('#id_published').datetimepicker({format:'Y-m-d H:i'});
        $('#id_first_seen').datetimepicker({format:'Y-m-d H:i'});
        $('#id_last_seen').datetimepicker({format:'Y-m-d H:i'});
        $('#id_valid_from').datetimepicker({format:'Y-m-d H:i'});
        $('#id_valid_until').datetimepicker({format:'Y-m-d H:i'});
        $('#id_first_observed').datetimepicker({format:'Y-m-d H:i'});
        $('#id_last_observed').datetimepicker({format:'Y-m-d H:i'});
        {% if type == "threat-actor" %}
        actorChart({{data|safe}});
        {% elif type == "identity" %}
        tgtChart({{data|safe}});
        {% endif %}
    }
);
</script>
{% endblock%}

{% block container %}

{% block modal_create %}
<div class="modal" id="create_form" role="dialog">
<div class="modal-dialog"><div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal">&times;</button>
<h4 class="modal-title">Create {{type|capfirst}}</h4></div>
<div class="modal-body"><form class="create_form" method=post>{% csrf_token %}
<table class="table">
{{form.as_table}}
</table>
<input class="btn btn-primary btn-sm" type="submit" name="create" value="Create">
</form></div><!--/.modal-body-->
</div><!--/.modal-content-->
</div><!--/.modal-dialog-->
</div><!--/.modal-->
{% endblock %}

{% block modal_bulk %}
<div class="modal" id="bulk_form" role="dialog">
<div class="modal-dialog"><div class="modal-content">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal">&times;</button>
<h4 class="modal-title">Bulk Create {{type|capfirst}}</h4></div>
<div class="modal-body">
<h4>Input Format: {{bulkformat}}</h4>
<form class="create_form" method=post>{% csrf_token %}
<table class="table">
{{sform.as_table}}
{{bulkform.as_table}}
</table>
<input class="btn btn-primary btn-sm" type="submit" name="create_bulk" value="Create">
</form></div><!--/.modal-body-->
</div><!--/.modal-content-->
</div><!--/.modal-dialog-->
</div><!--/.modal-->
{% endblock %}

{% block modal %}{% endblock %}

<div class="col-md-12">

{% block top_pane %}{% endblock %}

{% block left_pane %}
{% if type == "threat-actor" or type == "identity" %}
<div id="left_pane" class="col-md-7">
{% else %}
<div id="left_pane" class="col-md-12">
{% endif %}
<h3 style="margin-top: 0">{{type|capfirst}}
{% if request.user.is_authenticated %}
<a class="btn btn-primary btn-sm" data-toggle="modal" href="#create_form">Create</a>
<a class="btn btn-warning btn-sm" data-toggle="modal" href="#bulk_form">Bulk Create</a>
<a class="btn btn-default btn-sm"  href="/stix/{{type}}.json">STIX2</a>
{% endif %}
</h3>
<hr>
<table id="objtype_table" class="table table-condensed table-stripe table-hover display" width="100%">
<thead><tr>
{% block left_thead %}
<th >Created</th>
{% if type == "relationship" %}
<th>Object ID</th>
<th>Source</th>
<th>Type</th>
<th>Target</th>
{% elif type == "sighting" %}
<th>Object ID</th>
<th>Where Sighted</th>
<th>Sighting of</th>
{% elif type == "observed-data" %}
<th>Object ID</th>
<th>Objects</th>
{% else %}
<th >Name</th>
{% if type == "report" %}
<th class="col-md-2">Created By</th>
<th class="col-md-2">Published</th>
{% elif type == "attack-pattern" %}
<th class="col-md-3">Kill Chain</th>
{% elif type == "identity" %}
<th class="col-md-3">Sector</th>
{% elif type == "malware" or type == "tool" %}
<th class="col-md-3">Labels</th>
<th class="col-md-3">Kill Chain</th>
{% elif type == "campaign" or type == "intrusion-set" %}
<th >Aliases</th>
<th class="col-md-2">First Seen</th>
{% elif type == "threat-actor" %}
<th >Aliases</th>
{% elif type == "indicator" %}
<th >Pattern</th>
{% endif %}
{% endif %}
{% endblock %}
</tr></thead>
</table>
</div><!--/#left_pane-->
{% endblock %}

{% block right_pane %}
{% if type == "threat-actor" or type == "identity" %}
<div id="right_pane" class="col-md-5">
<div class="panel panel-default">

<div class="panel-heading">
Stats
</div>
<div class="panel-body">
<div id="container" style="height:75vh">
</div>
</div><!--/.panel-body-->
</div><!--/.panel-->
</div><!--/.col-md-6-->
{% endif %}
{% endblock %}

{% block stixvizlib %}{% endblock %}

{% endblock %}
